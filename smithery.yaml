# Smithery configuration

# Disable automatic Dockerfile generation
skip_dockerfile: true

# Build configuration
build:
  # Use the Dockerfile we provided
  dockerfile: Dockerfile
  # Increase build timeout to 15 minutes
  timeout: 900
  # Don't fail on warnings
  ignore_build_warnings: true

# Run configuration
run:
  # Command to start the FastAPI application
  command: uvicorn app.main:app --host 0.0.0.0 --port $PORT
  # Increase timeout for slow starting apps
  http_timeout: 60

# Environment variables (set these in Smithery dashboard)
env:
  # Required environment variables
  - GITHUB_APP_ID
  - GITHUB_APP_PRIVATE_KEY
  - GITHUB_WEBHOOK_SECRET
  - SLACK_BOT_TOKEN
  - SLACK_SIGNING_SECRET
  - DATABASE_URL
  - SECRET_KEY
  - PYTHONUNBUFFERED=1
  - PYTHONDONTWRITEBYTECODE=1

# Build environment
build_environment:
  python: "3.9"

# Deployment settings
deploy:
  auto_deploy: true
  branch: main
  # Skip builds if only non-code files change
  ignore: |
    README.md
    .gitignore
    .git/
    .github/
    docs/
    tests/

# Health check
health_check:
  path: /health
  timeout: 30
  interval: 60
  # Allow more time for the first health check
  start_period: 60

# Build caching
cache:
  paths:
    - ~/.cache/pip
    - /root/.cache/pip
  # Clear cache on every deploy
  clear_on_deploy: false

# Security headers
headers:
  - for: /*
    values:
      X-Frame-Options: DENY
      X-Content-Type-Options: nosniff
      X-XSS-Protection: "1; mode=block"
      Referrer-Policy: same-origin
      Content-Security-Policy: "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:;"

# Redirects (optional)
redirects:
  - from: /*
    to: /
    status: 200
    force: true

# Logging (optional)
logging:
  # Keep logs for 7 days
  retention_days: 7
  # Enable request logging
  http_access: true
