build:
  command: |
    pip install -r backend/requirements.txt &&
    python -c "from app.db.init_db import init_db; init_db()" &&
    alembic upgrade head
  publish: backend
  environment:
    - PORT=8000
    - ENV=development
  start: uvicorn app.main:app --host 0.0.0.0 --port $PORT
  variables:
    required:
      - SECRET_KEY
    optional:
      - DATABASE_URL
      - GITHUB_APP_ID
      - GITHUB_APP_PRIVATE_KEY
      - SLACK_BOT_TOKEN
      - SLACK_SIGNING_SECRET
